<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Étape 3 - SET</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .code-box { font-family: monospace; font-size: 12px; }
    </style>
</head>
<body class="container mt-4">
    <div class="card">
        <div class="card-header bg-warning text-dark">
            <h4>Étape 3: Création opérateur SET</h4>
        </div>
        <div class="card-body">
            <p>Création de l'opérateur SET contenant :</p>
            <ul>
                <li><strong>OT (Order Transcript)</strong>: Détails de la transaction</li>
                <li><strong>PC (Primary Account Number) chiffré</strong>: Numéro de carte chiffré RSA</li>
                <li><strong>Signature digitale</strong>: Signature de l'OT avec clé privée</li>
            </ul>
            
            <hr>
            
            <div class="row">
                <div class="col-md-6">
                    <h5>Détails transaction :</h5>
                    <form id="transactionForm">
                        <div class="mb-3">
                            <label class="form-label">Numéro de carte (PAN)</label>
                            <input type="text" class="form-control" id="pan" value="4242424242424242">
                            <small class="text-muted">Numéro de test Visa</small>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Marchand</label>
                            <input type="text" class="form-control" id="marchand" value="Amazon FR">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Montant (€)</label>
                            <input type="number" class="form-control" id="montant" value="150">
                        </div>
                        
                        <button type="button" class="btn btn-primary" onclick="creerOperateur()">
                            Créer Opérateur SET
                        </button>
                    </form>
                </div>
                
                <div class="col-md-6">
                    <h5>Résultat :</h5>
                    <div id="result" class="code-box p-3 bg-light" style="min-height: 200px;">
                        En attente de création...
                    </div>
                </div>
            </div>
            
            <hr>
            
            <div class="d-flex justify-content-between">
                <a href="/etape2" class="btn btn-secondary">← Étape 2</a>
                <a href="/etape4" class="btn btn-primary" id="nextBtn" style="display: none;">
                    Suivant → Étape 4: Envoi à la banque
                </a>
            </div>
        </div>
    </div>
    
    <script>
    function creerOperateur() {
        const data = {
            pan: document.getElementById('pan').value,
            marchand: document.getElementById('marchand').value,
            montant: document.getElementById('montant').value
        };
        
        fetch('/api/creer_operateur', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(r => r.json())
        .then(data => {
            document.getElementById('result').innerHTML = 
                `<strong>✅ Opérateur SET créé</strong><br><br>
                 <strong>OT:</strong><br>
                 ${JSON.stringify(data.set_operator.ot, null, 2)}<br><br>
                 <strong>PC chiffré:</strong><br>
                 ${data.set_operator.pc_chiffre}<br><br>
                 <strong>Signature:</strong><br>
                 ${data.set_operator.signature}`;
            
            document.getElementById('nextBtn').style.display = 'block';
        });
    }
    </script>
</body>
</html>