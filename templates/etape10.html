<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>√âtape 10 - SET</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <style>
        .crisis-card {
            border-left: 5px solid #dc3545;
            transition: all 0.3s;
        }
        .crisis-card:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.2);
        }
        .scan-animation {
            animation: scan 2s infinite;
        }
        @keyframes scan {
            0% { background-color: #f8d7da; }
            50% { background-color: #fff3cd; }
            100% { background-color: #f8d7da; }
        }
        .log-box {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="container mt-4">
    <div class="card crisis-card">
        <div class="card-header text-white" style="background: linear-gradient(45deg, #dc3545, #fd7e14);">
            <h4><i class="bi bi-shield-exclamation"></i> √âtape 10: Enqu√™te de Crise</h4>
        </div>
        <div class="card-body">
            <div class="alert alert-warning">
                <h5><i class="bi bi-exclamation-triangle-fill"></i> Syst√®me de Surveillance SET</h5>
                <p>Analyse en temps r√©el des transactions pour d√©tecter les anomalies et fraudes potentielles.</p>
            </div>
            
            <div class="row">
                <div class="col-md-8">
                    <div class="card mb-3">
                        <div class="card-header bg-dark text-white">
                            <h6><i class="bi bi-terminal"></i> Journal de Surveillance</h6>
                        </div>
                        <div class="card-body">
                            <div class="log-box bg-dark text-light p-3 rounded" id="surveillance-log">
                                > Syst√®me d'enqu√™te SET initialis√©<br>
                                > En attente de transaction...<br>
                            </div>
                            
                            <div class="mt-3">
                                <button class="btn btn-outline-warning" onclick="lancerEnquete()">
                                    <i class="bi bi-play-fill"></i> Lancer l'Enqu√™te
                                </button>
                                <button class="btn btn-outline-secondary" onclick="reinitialiserLog()">
                                    <i class="bi bi-arrow-clockwise"></i> R√©initialiser
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="card mb-3">
                        <div class="card-header bg-danger text-white">
                            <h6><i class="bi bi-clipboard-data"></i> M√©triques de Surveillance</h6>
                        </div>
                        <div class="card-body text-center">
                            <div class="row">
                                <div class="col-6 mb-3">
                                    <div class="p-3 border rounded bg-light">
                                        <h2 id="score-risk" class="text-success">0</h2>
                                        <small>Score de Risque</small>
                                    </div>
                                </div>
                                <div class="col-6 mb-3">
                                    <div class="p-3 border rounded bg-light">
                                        <h2 id="anomalies" class="text-warning">0</h2>
                                        <small>Anomalies</small>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="p-3 border rounded bg-light">
                                        <h2 id="checks" class="text-primary">0</h2>
                                        <small>V√©rifications</small>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="p-3 border rounded bg-light">
                                        <h2 id="status" class="text-success">OK</h2>
                                        <small>Statut</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h6><i class="bi bi-search"></i> Points de Contr√¥le</h6>
                        </div>
                        <div class="card-body">
                            <div class="list-group">
                                <div class="list-group-item">
                                    <i class="bi bi-check-circle-fill text-success"></i>
                                    <strong>Certificat Valide</strong>
                                    <small class="text-muted float-end">PASS</small>
                                </div>
                                <div class="list-group-item">
                                    <i class="bi bi-check-circle-fill text-success"></i>
                                    <strong>Signature Digitale</strong>
                                    <small class="text-muted float-end">PASS</small>
                                </div>
                                <div class="list-group-item">
                                    <i class="bi bi-check-circle-fill text-success"></i>
                                    <strong>Format SET</strong>
                                    <small class="text-muted float-end">PASS</small>
                                </div>
                                <div class="list-group-item">
                                    <i class="bi bi-clock-history text-warning"></i>
                                    <strong>Analyse Comportementale</strong>
                                    <small class="text-muted float-end">EN COURS</small>
                                </div>
                                <div class="list-group-item">
                                    <i class="bi bi-clock-history text-warning"></i>
                                    <strong>V√©rification R√©seau</strong>
                                    <small class="text-muted float-end">EN COURS</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-warning text-dark">
                            <h6><i class="bi bi-shield-shaded"></i> D√©tection d'Anomalies</h6>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-light scan-animation">
                                <h6><i class="bi bi-radar"></i> Scan en cours...</h6>
                                <div class="progress mt-2">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                         id="scan-progress" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div id="anomalies-detected" class="mt-3" style="display: none;">
                                <div class="alert alert-danger">
                                    <h6><i class="bi bi-exclamation-octagon"></i> Anomalies D√©tect√©es</h6>
                                    <div id="anomalies-list"></div>
                                </div>
                            </div>
                            
                            <div id="no-anomalies" class="mt-3" style="display: none;">
                                <div class="alert alert-success">
                                    <h6><i class="bi bi-shield-check"></i> Aucune Anomalie</h6>
                                    <p>La transaction semble l√©gitime.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header bg-secondary text-white">
                    <h6><i class="bi bi-graph-up"></i> Analyse de Risque</h6>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col">
                            <canvas id="riskChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button class="btn btn-outline-info" onclick="analyserRisque()">
                            <i class="bi bi-graph-up-arrow"></i> Lancer l'Analyse de Risque
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="alert alert-success mt-4" id="crisis-complete" style="display: none;">
                <h5><i class="bi bi-flag-fill"></i> Enqu√™te de Crise Termin√©e</h5>
                <p>‚úÖ Tous les contr√¥les de s√©curit√© ont √©t√© effectu√©s.</p>
                <p>‚úÖ La transaction est valid√©e pour traitement final.</p>
                <p>üîÑ Passage √† la confirmation finale...</p>
            </div>
            
            <div class="d-flex justify-content-between mt-4">
                <a href="/etape9" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> √âtape 9
                </a>
                <a href="/etape11" class="btn btn-success" id="next-btn" style="display: none;">
                    Suivant <i class="bi bi-check-circle"></i> Confirmation Finale
                </a>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    let logLines = 2;
    let riskScore = 0;
    let anomalyCount = 0;
    let checkCount = 0;
    
    function log(message) {
        const logBox = document.getElementById('surveillance-log');
        const timestamp = new Date().toLocaleTimeString();
        logBox.innerHTML += `[${timestamp}] ${message}<br>`;
        logBox.scrollTop = logBox.scrollHeight;
        logLines++;
    }
    
    function updateMetrics() {
        document.getElementById('score-risk').textContent = riskScore;
        document.getElementById('anomalies').textContent = anomalyCount;
        document.getElementById('checks').textContent = checkCount;
    }
    
    function lancerEnquete() {
        log("üîç Lancement de l'enqu√™te de crise...");
        
        // Simulation de v√©rifications
        const checks = [
            {msg: "V√©rification certificat...", delay: 1000},
            {msg: "‚úÖ Certificat valide et non r√©voqu√©", delay: 800},
            {msg: "Analyse signature digitale...", delay: 1200},
            {msg: "‚úÖ Signature valide - Int√©grit√© confirm√©e", delay: 900},
            {msg: "V√©rification comportement transaction...", delay: 1500},
            {msg: "‚úÖ Mod√®le comportemental normal", delay: 700},
            {msg: "Analyse g√©ographique...", delay: 1100},
            {msg: "‚úÖ Localisation coh√©rente", delay: 600},
            {msg: "V√©rification historique client...", delay: 1300},
            {msg: "‚úÖ Historique sans anomalie", delay: 800},
            {msg: "Scan anti-fraude...", delay: 2000},
            {msg: "‚úÖ Aucun pattern frauduleux d√©tect√©", delay: 700}
        ];
        
        let i = 0;
        function nextCheck() {
            if (i < checks.length) {
                log(checks[i].msg);
                checkCount++;
                updateMetrics();
                
                // Animation de progression
                const progress = ((i + 1) / checks.length) * 100;
                document.getElementById('scan-progress').style.width = progress + '%';
                
                i++;
                setTimeout(nextCheck, checks[i-1].delay);
            } else {
                log("‚úÖ Enqu√™te de crise termin√©e avec succ√®s");
                document.getElementById('status').textContent = 'SAFE';
                document.getElementById('status').className = 'text-success';
                
                // Afficher r√©sultat
                if (Math.random() > 0.8) { // 20% de chance d'anomalie
                    anomalyCount = Math.floor(Math.random() * 2) + 1;
                    document.getElementById('anomalies-list').innerHTML = 
                        `<ul>
                            <li>Transaction l√©g√®rement inhabituelle</li>
                            <li>V√©rification manuelle recommand√©e</li>
                        </ul>`;
                    document.getElementById('anomalies-detected').style.display = 'block';
                    riskScore = 35;
                } else {
                    document.getElementById('no-anomalies').style.display = 'block';
                    riskScore = 15;
                }
                
                updateMetrics();
                analyserRisque();
                document.getElementById('crisis-complete').style.display = 'block';
                document.getElementById('next-btn').style.display = 'inline-block';
            }
        }
        
        nextCheck();
    }
    
    function reinitialiserLog() {
        document.getElementById('surveillance-log').innerHTML = 
            '> Syst√®me d\'enqu√™te SET initialis√©<br>> En attente de transaction...<br>';
        logLines = 2;
        riskScore = 0;
        anomalyCount = 0;
        checkCount = 0;
        updateMetrics();
        document.getElementById('status').textContent = 'OK';
        document.getElementById('status').className = 'text-success';
        document.getElementById('scan-progress').style.width = '0%';
        document.getElementById('anomalies-detected').style.display = 'none';
        document.getElementById('no-anomalies').style.display = 'none';
        document.getElementById('crisis-complete').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
    }
    
    function analyserRisque() {
        const ctx = document.getElementById('riskChart').getContext('2d');
        
        // D√©truire le graphique existant s'il y en a un
        if (window.riskChart) {
            window.riskChart.destroy();
        }
        
        // Donn√©es simul√©es
        const data = {
            labels: ['Certificat', 'Signature', 'Comportement', 'Localisation', 'Historique'],
            datasets: [{
                label: 'Score de Risque',
                data: [
                    Math.random() * 10,       // Certificat
                    Math.random() * 15,       // Signature
                    Math.random() * 40 + 10,  // Comportement
                    Math.random() * 20,       // Localisation
                    Math.random() * 25        // Historique
                ],
                backgroundColor: [
                    'rgba(75, 192, 192, 0.5)',
                    'rgba(54, 162, 235, 0.5)',
                    'rgba(255, 206, 86, 0.5)',
                    'rgba(153, 102, 255, 0.5)',
                    'rgba(255, 99, 132, 0.5)'
                ],
                borderColor: [
                    'rgba(75, 192, 192, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 99, 132, 1)'
                ],
                borderWidth: 2
            }]
        };
        
        const config = {
            type: 'radar',
            data: data,
            options: {
                scales: {
                    r: {
                        angleLines: {
                            display: true
                        },
                        suggestedMin: 0,
                        suggestedMax: 50
                    }
                },
                plugins: {
                    legend: {
                        display: true
                    }
                }
            }
        };
        
        window.riskChart = new Chart(ctx, config);
    }
    
    // Initialisation
    document.addEventListener('DOMContentLoaded', function() {
        updateMetrics();
    });
    </script>
</body>
</html>