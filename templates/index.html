<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocole SET - Simple</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <style>
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 30px;
            margin-top: 20px;
        }
        .step-card { 
            margin-bottom: 20px;
            border-left: 5px solid;
            transition: transform 0.3s, box-shadow 0.3s;
            border-radius: 10px;
        }
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .step-number { 
            font-size: 24px; 
            font-weight: bold; 
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            color: white;
            margin-right: 15px;
        }
        .btn-set { 
            background: linear-gradient(45deg, #667eea, #764ba2); 
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: bold;
        }
        .btn-set:hover {
            background: linear-gradient(45deg, #764ba2, #667eea);
            color: white;
            transform: scale(1.05);
        }
        .protocol-flow {
            position: relative;
            padding: 20px 0;
        }
        .protocol-flow::before {
            content: '';
            position: absolute;
            left: 25px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
            border-radius: 2px;
        }
        .status-badge {
            position: absolute;
            right: 15px;
            top: 15px;
        }
        .crypto-badge {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }
        .step-active .step-number {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .step-completed .step-card {
            border-left-color: #28a745 !important;
        }
        .hero-section {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }
        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Hero Section -->
        <div class="hero-section">
            <h1 class="text-primary mb-3">
                <i class="bi bi-shield-lock"></i> Protocole SET Simplifié
            </h1>
            <p class="lead mb-4">
                Implémentation simple et pédagogique du protocole Secure Electronic Transaction
            </p>
            
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="alert alert-info">
                        <h5><i class="bi bi-info-circle"></i> Qu'est-ce que le protocole SET ?</h5>
                        <p class="mb-0">
                            SET (Secure Electronic Transaction) est un protocole de paiement sécurisé développé par Visa et MasterCard 
                            pour les transactions en ligne. Il utilise la cryptographie asymétrique (RSA) pour garantir la confidentialité 
                            et l'authenticité des transactions.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-container">
            <div class="row">
                <!-- Étapes du protocole -->
                <div class="col-lg-8">
                    <h3 class="mb-4 border-bottom pb-2">
                        <i class="bi bi-list-ol"></i> Les 11 Étapes du Protocole SET
                    </h3>
                    
                    <div class="protocol-flow">
                        <!-- Étape 1 -->
                        <div class="step-completed">
                            <div class="card step-card" style="border-left-color: #0d6efd;">
                                <div class="card-body d-flex align-items-center">
                                    <div class="step-number" style="background: #0d6efd;">1</div>
                                    <div class="flex-grow-1">
                                        <h5 class="card-title">Demande de certificat</h5>
                                        <p class="card-text mb-1">
                                            Le client génère une paire de clés RSA 2048 bits et demande un certificat à l'autorité de certification.
                                        </p>
                                        <small class="text-muted">
                                            <i class="bi bi-key"></i> Génération de clés cryptographiques
                                        </small>
                                    </div>
                                    <div>
                                        <a href="/etape1" class="btn btn-sm btn-outline-primary">
                                            Commencer <i class="bi bi-arrow-right"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Étape 2 -->
                        <div class="step-completed">
                            <div class="card step-card" style="border-left-color: #198754;">
                                <div class="card-body d-flex align-items-center">
                                    <div class="step-number" style="background: #198754;">2</div>
                                    <div class="flex-grow-1">
                                        <h5 class="card-title">Certificat émis</h5>
                                        <p class="card-text mb-1">
                                            L'autorité de certification valide et émet un certificat numérique signé.
                                        </p>
                                        <small class="text-muted">
                                            <i class="bi bi-patch-check"></i> Signature digitale par la CA
                                        </small>
                                    </div>
                                    <div>
                                        <a href="/etape2" class="btn btn-sm btn-outline-success">
                                            Voir <i class="bi bi-eye"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Étape 3 -->
                        <div class="step-active">
                            <div class="card step-card" style="border-left-color: #fd7e14;">
                                <div class="card-body d-flex align-items-center">
                                    <div class="step-number" style="background: #fd7e14;">3</div>
                                    <div class="flex-grow-1">
                                        <h5 class="card-title">Création opérateur SET</h5>
                                        <p class="card-text mb-1">
                                            Création de l'OT (Order Transcript), chiffrement du PAN (Primary Account Number) et signature digitale.
                                        </p>
                                        <small class="text-muted">
                                            <i class="bi bi-file-lock"></i> OT + PC chiffré + Signature
                                        </small>
                                    </div>
                                    <div>
                                        <a href="/etape3" class="btn btn-sm btn-outline-warning">
                                            Créer <i class="bi bi-plus-circle"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Étape 4 -->
                        <div>
                            <div class="card step-card" style="border-left-color: #0dcaf0;">
                                <div class="card-body d-flex align-items-center">
                                    <div class="step-number" style="background: #0dcaf0;">4</div>
                                    <div class="flex-grow-1">
                                        <h5 class="card-title">Envoi à la banque</h5>
                                        <p class="card-text mb-1">
                                            Envoi sécurisé de l'opérateur SET à la banque pour vérification.
                                        </p>
                                        <small class="text-muted">
                                            <i class="bi bi-send"></i> Transmission sécurisée
                                        </small>
                                    </div>
                                    <div>
                                        <a href="/etape4" class="btn btn-sm btn-outline-info">
                                            Envoyer <i class="bi bi-send"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Étape 5 & 6 -->
                        <div>
                            <div class="card step-card" style="border-left-color: #20c997;">
                                <div class="card-body d-flex align-items-center">
                                    <div class="step-number" style="background: #20c997;">5&6</div>
                                    <div class="flex-grow-1">
                                        <h5 class="card-title">Vérification & Certification OK</h5>
                                        <p class="card-text mb-1">
                                            La banque vérifie la structure, le certificat et la signature. Validation réussie.
                                        </p>
                                        <small class="text-muted">
                                            <i class="bi bi-check-circle"></i> Vérifications complètes
                                        </small>
                                    </div>
                                    <div>
                                        <a href="/etape5" class="btn btn-sm btn-outline-success">
                                            Vérifier <i class="bi bi-shield-check"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Étape 7 -->
                        <div>
                            <div class="card step-card" style="border-left-color: #dc3545;">
                                <div class="card-body d-flex align-items-center">
                                    <div class="step-number" style="background: #dc3545;">7</div>
                                    <div class="flex-grow-1">
                                        <h5 class="card-title">Demande d'achat</h5>
                                        <p class="card-text mb-1">
                                            Demande de paiement avec le PAN chiffré (Primary Account Number).
                                        </p>
                                        <small class="text-muted">
                                            <i class="bi bi-credit-card"></i> PAN chiffré RSA
                                        </small>
                                    </div>
                                    <div>
                                        <a href="/etape7" class="btn btn-sm btn-outline-danger">
                                            Demander <i class="bi bi-cart-check"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Étape 8 -->
                        <div>
                            <div class="card step-card" style="border-left-color: #ffc107;">
                                <div class="card-body d-flex align-items-center">
                                    <div class="step-number" style="background: #ffc107;">8</div>
                                    <div class="flex-grow-1">
                                        <h5 class="card-title">Achat en 2 phases</h5>
                                        <p class="card-text mb-1">
                                            Phase 1: Autorisation. Phase 2: Capture du paiement.
                                        </p>
                                        <small class="text-muted">
                                            <i class="bi bi-arrow-repeat"></i> Autorisation + Capture
                                        </small>
                                    </div>
                                    <div>
                                        <a href="/etape8" class="btn btn-sm btn-outline-warning">
                                            Traiter <i class="bi bi-arrow-right-left"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Étape 9 -->
                        <div>
                            <div class="card step-card" style="border-left-color: #6f42c1;">
                                <div class="card-body d-flex align-items-center">
                                    <div class="step-number" style="background: #6f42c1;">9</div>
                                    <div class="flex-grow-1">
                                        <h5 class="card-title">Aide solidaire + MEC</h5>
                                        <p class="card-text mb-1">
                                            Support technique et traitement des messages d'échange (MEC).
                                        </p>
                                        <small class="text-muted">
                                            <i class="bi bi-headset"></i> Support + Messages SET
                                        </small>
                                    </div>
                                    <div>
                                        <a href="/etape9" class="btn btn-sm btn-outline-primary">
                                            Gérer <i class="bi bi-chat-dots"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Étape 10 -->
                        <div>
                            <div class="card step-card" style="border-left-color: #fd7e14;">
                                <div class="card-body d-flex align-items-center">
                                    <div class="step-number" style="background: #fd7e14;">10</div>
                                    <div class="flex-grow-1">
                                        <h5 class="card-title">Enquête de crise</h5>
                                        <p class="card-text mb-1">
                                            Surveillance et détection d'anomalies pour prévenir la fraude.
                                        </p>
                                        <small class="text-muted">
                                            <i class="bi bi-shield-exclamation"></i> Détection d'anomalies
                                        </small>
                                    </div>
                                    <div>
                                        <a href="/etape10" class="btn btn-sm btn-outline-warning">
                                            Surveiller <i class="bi bi-binoculars"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Étape 11 -->
                        <div>
                            <div class="card step-card" style="border-left-color: #198754;">
                                <div class="card-body d-flex align-items-center">
                                    <div class="step-number" style="background: #198754;">11</div>
                                    <div class="flex-grow-1">
                                        <h5 class="card-title">Confirmation finale</h5>
                                        <p class="card-text mb-1">
                                            Confirmation de la transaction complétée avec succès.
                                        </p>
                                        <small class="text-muted">
                                            <i class="bi bi-flag-fill"></i> Transaction terminée
                                        </small>
                                    </div>
                                    <div>
                                        <a href="/etape11" class="btn btn-sm btn-outline-success">
                                            Confirmer <i class="bi bi-check-lg"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <button class="btn btn-set btn-lg" onclick="executerTransactionComplete()">
                            <i class="bi bi-play-fill"></i> Exécuter toute la transaction SET
                        </button>
                    </div>
                </div>
                
                <!-- Sidebar Info -->
                <div class="col-lg-4">
                    <div class="sticky-top" style="top: 20px;">
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h5><i class="bi bi-cpu"></i> Caractéristiques SET</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="feature-icon text-primary">
                                        <i class="bi bi-shield-shaded"></i>
                                    </div>
                                    <div>
                                        <h6>Cryptographie avancée</h6>
                                        <p class="mb-0 small">RSA 2048 bits, signatures SHA256</p>
                                    </div>
                                </div>
                                
                                <div class="d-flex align-items-center mb-3">
                                    <div class="feature-icon text-success">
                                        <i class="bi bi-key"></i>
                                    </div>
                                    <div>
                                        <h6>Double signature</h6>
                                        <p class="mb-0 small">Client et marchand signent la transaction</p>
                                    </div>
                                </div>
                                
                                <div class="d-flex align-items-center mb-3">
                                    <div class="feature-icon text-warning">
                                        <i class="bi bi-credit-card-2-front"></i>
                                    </div>
                                    <div>
                                        <h6>Confidentialité PAN</h6>
                                        <p class="mb-0 small">Le numéro de carte reste chiffré</p>
                                    </div>
                                </div>
                                
                                <div class="d-flex align-items-center">
                                    <div class="feature-icon text-info">
                                        <i class="bi bi-file-check"></i>
                                    </div>
                                    <div>
                                        <h6>Certificats X.509</h6>
                                        <p class="mb-0 small">Authentification forte des parties</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mb-4">
                            <div class="card-header bg-info text-white">
                                <h5><i class="bi bi-lightning-charge"></i> Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <a href="/reset" class="btn btn-outline-danger">
                                        <i class="bi bi-arrow-clockwise"></i> Réinitialiser la session
                                    </a>
                                    <button class="btn btn-outline-primary" onclick="genererNouvelleTransaction()">
                                        <i class="bi bi-plus-circle"></i> Nouvelle transaction
                                    </button>
                                    <button class="btn btn-outline-success" onclick="afficherStatut()">
                                        <i class="bi bi-info-circle"></i> Voir statut session
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5><i class="bi bi-graph-up"></i> Statistiques</h5>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-6 mb-3">
                                        <div class="p-3 border rounded bg-light">
                                            <h3 class="text-primary" id="stat-transactions">1</h3>
                                            <small>Transaction</small>
                                        </div>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <div class="p-3 border rounded bg-light">
                                            <h3 class="text-success" id="stat-etapes">3</h3>
                                            <small>Étapes faites</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="p-3 border rounded bg-light">
                                            <h3 class="text-warning" id="stat-crypto">RSA</h3>
                                            <small>Cryptographie</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="p-3 border rounded bg-light">
                                            <h3 class="text-info" id="stat-status">Actif</h3>
                                            <small>Statut</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-warning mt-4">
                            <h6><i class="bi bi-exclamation-triangle"></i> À propos</h6>
                            <p class="mb-0 small">
                                Cette application est une démonstration pédagogique du protocole SET.
                                Elle utilise une cryptographie réelle (RSA 2048) pour illustrer les concepts.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="row mt-5">
                <div class="col-12 text-center">
                    <hr>
                    <p class="text-muted">
                        <small>
                            <i class="bi bi-code-slash"></i> Protocole SET Simplifié - 
                            Démonstration pédagogique - 
                            Utilise Flask et PyCryptodome
                        </small>
                    </p>
                    <div class="mt-2">
                        <span class="badge bg-primary">RSA 2048</span>
                        <span class="badge bg-success">SET Protocol</span>
                        <span class="badge bg-warning">Cryptographie</span>
                        <span class="badge bg-info">Transactions Sécurisées</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal pour le statut -->
    <div class="modal fade" id="statusModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Statut de la Session</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="sessionStatus">
                        Chargement...
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Fonction pour exécuter toute la transaction
    function executerTransactionComplete() {
        if (confirm('Voulez-vous exécuter toute la transaction SET ? Cela va naviguer automatiquement à travers toutes les étapes.')) {
            let steps = [
                '/etape1',
                '/etape2', 
                '/etape3',
                '/etape4',
                '/etape5',
                '/etape7',
                '/etape8',
                '/etape9',
                '/etape10',
                '/etape11'
            ];
            
            let currentStep = 0;
            
            function nextStep() {
                if (currentStep < steps.length) {
                    window.location.href = steps[currentStep];
                    currentStep++;
                    
                    // Attendre 2 secondes avant la prochaine étape
                    if (currentStep < steps.length) {
                        setTimeout(nextStep, 2000);
                    }
                }
            }
            
            nextStep();
        }
    }
    
    // Générer une nouvelle transaction
    function genererNouvelleTransaction() {
        fetch('/reset')
            .then(() => {
                alert('Nouvelle transaction générée !');
                window.location.reload();
            })
            .catch(error => {
                alert('Erreur: ' + error);
            });
    }
    
    // Afficher le statut de la session
    function afficherStatut() {
        fetch('/api/status')
            .then(response => response.json())
            .then(data => {
                let html = '<h6>Informations de session:</h6>';
                html += '<div class="alert alert-info">';
                html += `<p><strong>Client ID:</strong> ${data.session.client_id || 'Non défini'}</p>`;
                html += `<p><strong>Transaction ID:</strong> ${data.session.transaction_id || 'Non défini'}</p>`;
                html += `<p><strong>Certificat:</strong> ${data.session.certificat ? 'Généré ✓' : 'Non généré'}</p>`;
                html += `<p><strong>Clés RSA:</strong> ${data.session.client_private_key ? 'Générées ✓' : 'Non générées'}</p>`;
                html += `<p><strong>Dernière mise à jour:</strong> ${data.timestamp}</p>`;
                html += '</div>';
                
                document.getElementById('sessionStatus').innerHTML = html;
                
                // Afficher le modal
                const modal = new bootstrap.Modal(document.getElementById('statusModal'));
                modal.show();
            })
            .catch(error => {
                document.getElementById('sessionStatus').innerHTML = 
                    '<div class="alert alert-danger">Erreur de chargement du statut</div>';
                const modal = new bootstrap.Modal(document.getElementById('statusModal'));
                modal.show();
            });
    }
    
    // Mettre à jour les statistiques
    function updateStats() {
        // Simuler des statistiques
        document.getElementById('stat-transactions').textContent = 
            Math.floor(Math.random() * 5) + 1;
        document.getElementById('stat-etapes').textContent = 
            Math.floor(Math.random() * 11) + 1;
    }
    
    // Mettre à jour les stats toutes les 10 secondes
    setInterval(updateStats, 10000);
    
    // Initialisation
    document.addEventListener('DOMContentLoaded', function() {
        updateStats();
    });
    </script>
</body>
</html>