<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Étape 4 - SET</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">
    <div class="card">
        <div class="card-header bg-info text-white">
            <h4>Étape 4: Envoi à la banque</h4>
        </div>
        <div class="card-body">
            <p>Envoi de l'opérateur SET à la banque pour vérification.</p>
            
            <div class="alert alert-warning">
                <strong>Contenu envoyé :</strong><br>
                • OT (Order Transcript) - Détails transaction<br>
                • PC chiffré - Numéro de carte chiffré<br>
                • Signature digitale<br>
                • Certificat client
            </div>
            
            <button class="btn btn-primary mb-3" onclick="envoyerBanque()">
                Envoyer à la banque
            </button>
            
            <div id="result" class="code-box p-3 bg-light mb-3" style="min-height: 100px;">
                En attente d'envoi...
            </div>
            
            <div class="d-flex justify-content-between">
                <a href="/etape3" class="btn btn-secondary">← Étape 3</a>
                <a href="/etape5" class="btn btn-primary" id="nextBtn" style="display: none;">
                    Suivant → Étape 5: Vérifications
                </a>
            </div>
        </div>
    </div>
    
    <script>
    function envoyerBanque() {
        fetch('/api/envoyer_banque', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(r => r.json())
        .then(data => {
            document.getElementById('result').innerHTML = 
                `<strong>✅ Requête envoyée</strong><br><br>
                 <strong>Vérifications :</strong><br>
                 • Structure SET: ${data.verifications.structure ? '✓ OK' : '✗ Erreur'}<br>
                 • Certificat: ${data.verifications.certificat ? '✓ VALIDE' : '✗ INVALIDE'}<br>
                 • Signature: ${data.verifications.signature ? '✓ CORRECTE' : '✗ INCORRECTE'}`;
            
            if (data.verifications.structure && data.verifications.certificat && data.verifications.signature) {
                document.getElementById('nextBtn').style.display = 'block';
            }
        });
    }
    </script>
</body>
</html>